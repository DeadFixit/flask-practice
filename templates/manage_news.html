{% extends 'base.html' %}
{% block content %}
<section class="page-header">
    <h1>Управление новостями</h1>
    <p class="lead">Создание, редактирование и удаление новостей. Удаление доступно только администратору.</p>
</section>
<div class="grid two">
    <form class="panel" method="post" action="{{ active_item and url_for('edit_news', news_id=active_item.id) or url_for('manage_news') }}">
        <h2>{{ active_item and 'Редактирование' or 'Новая новость' }}</h2>
        <label>Заголовок
            <input type="text" name="title" value="{{ active_item.title if active_item else '' }}" required>
        </label>
        <label>Дата (ГГГГ-ММ-ДД)
            <input type="text" name="date" value="{{ active_item.date if active_item else '' }}" required>
        </label>
        <label>Краткое содержание
            <textarea name="summary" rows="4" required>{{ active_item.summary if active_item else '' }}</textarea>
        </label>
        <button class="primary" type="submit">{{ active_item and 'Сохранить изменения' or 'Опубликовать' }}</button>
        {% if active_item %}
            <a class="secondary" href="{{ url_for('manage_news') }}">Сбросить форму</a>
        {% endif %}
    </form>
    <div class="panel">
        <h2>Все публикации</h2>
        {% if news_items %}
            <ul class="news-list">
                {% for item in news_items %}
                    <li class="news-item">
                        <div class="news-date">{{ item.date }} · Автор: {{ item.author }}</div>
                        <div class="news-title">{{ item.title }}</div>
                        <div class="news-summary">{{ item.summary }}</div>
                        <div class="small">
                            <a href="{{ url_for('edit_news', news_id=item.id) }}">Редактировать</a>
                            {% if current_user.role == 'admin' %}
                                ·
                                <form method="post" action="{{ url_for('delete_news', news_id=item.id) }}" style="display:inline" onsubmit="return confirm('Удалить новость?');">
                                    <button type="submit" class="secondary">Удалить</button>
                                </form>
                            {% endif %}
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="small">Публикаций пока нет.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
